<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>è´è´ç†Š - ä½ çš„å¸ƒå¨ƒå¨ƒä¼™ä¼´</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        :root {
            --bear-brown: #8B4513;
            --bear-light: #D2691E;
            --bear-bg: #FFF8DC;
            --shadow: 0 5px 15px rgba(139, 69, 19, 0.1);
        }
        * { margin: 0; padding: 0; box-sizing: border-box; font-family: 'Comic Sans MS', 'Ma Shan Zheng', cursive, sans-serif; }
        body {
            background: linear-gradient(135deg, var(--bear-bg) 0%, #f5e6ca 100%);
            min-height: 100vh; display: flex; flex-direction: column; align-items: center;
            padding: 20px; color: #5a3921;
        }
        .header {
            text-align: center; margin: 20px 0 30px; padding: 20px;
            background: white; border-radius: 25px; box-shadow: var(--shadow);
            border: 4px dashed var(--bear-light); max-width: 800px; width: 95%;
        }
        .title { color: var(--bear-brown); font-size: 3em; margin-bottom: 10px; }
        .subtitle { color: var(--bear-light); font-size: 1.2em; }
        .container {
            display: flex; flex-direction: column; width: 95%; max-width: 900px;
            background: white; border-radius: 25px; box-shadow: var(--shadow);
            overflow: hidden; border: 5px solid white; flex-grow: 1;
        }
        .chat-container {
            flex-grow: 1; padding: 25px; overflow-y: auto; display: flex;
            flex-direction: column; gap: 20px; background: #fcf6e9;
        }
        .message {
            max-width: 85%; padding: 18px 22px; border-radius: 25px;
            line-height: 1.6; box-shadow: 0 3px 8px rgba(0,0,0,0.05);
            position: relative; animation: fadeIn 0.3s ease-out;
        }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
        .user-message {
            align-self: flex-end; background: linear-gradient(to bottom right, #e3f2fd, #bbdefb);
            color: #1565c0; border-bottom-right-radius: 8px; border-left: 4px solid #64b5f6;
        }
        .bear-message {
            align-self: flex-start; background: linear-gradient(to bottom right, #fff3e0, #ffcc80);
            color: #5d4037; border-bottom-left-radius: 8px; border-right: 4px solid var(--bear-light);
        }
        .bear-message::before {
            content: 'ğŸ§¸'; position: absolute; left: -45px; top: 5px;
            font-size: 2em; transform: rotate(-15deg);
        }
        .message strong { color: #bf360c; }
        .input-area {
            display: flex; padding: 20px; background: #fffaf0;
            border-top: 3px dotted var(--bear-light); gap: 15px;
        }
        #userInput {
            flex-grow: 1; padding: 18px 20px; border: 3px solid #ffccbc;
            border-radius: 20px; font-size: 1.1em; outline: none;
            transition: all 0.3s; background: #fffef7;
        }
        #userInput:focus { border-color: var(--bear-brown); background: white; }
        #sendBtn {
            background: linear-gradient(to bottom, var(--bear-brown), var(--bear-light));
            color: white; border: none; padding: 0 30px; border-radius: 20px;
            font-size: 1.2em; font-weight: bold; cursor: pointer;
            display: flex; align-items: center; gap: 10px; transition: transform 0.2s;
        }
        #sendBtn:hover { transform: scale(1.05); }
        #sendBtn:active { transform: scale(0.98); }
        .typing-indicator {
            align-self: flex-start; background: #fff3e0; padding: 15px 25px;
            border-radius: 25px; display: none; border-right: 4px solid var(--bear-light);
            margin-bottom: 10px;
        }
        .typing-dots { display: inline-block; }
        .typing-dots span {
            animation: typing 1.4s infinite; opacity: 0.6;
            margin: 0 2px;
        }
        .typing-dots span:nth-child(2) { animation-delay: 0.2s; }
        .typing-dots span:nth-child(3) { animation-delay: 0.4s; }
        @keyframes typing {
            0%, 100% { transform: translateY(0); }
            50% { transform: translateY(-5px); opacity: 1; }
        }
        .warning {
            background: #ffebee; color: #c62828; padding: 15px;
            border-radius: 15px; margin-top: 20px; text-align: center;
            max-width: 900px; width: 95%; border: 2px solid #ffcdd2;
            font-size: 0.9em;
        }
        .controls { display: flex; gap: 15px; margin-top: 15px; justify-content: center; }
        .icon-btn {
            background: #ffcc80; border: none; padding: 12px 20px;
            border-radius: 20px; cursor: pointer; display: flex;
            align-items: center; gap: 8px; font-weight: bold; color: #5d4037;
        }
        .footer { margin-top: 20px; text-align: center; color: #8d6e63; font-size: 0.9em; }
        @media (max-width: 768px) {
            .title { font-size: 2.2em; }
            .message { max-width: 95%; }
            .bear-message::before { display: none; }
        }
    </style>
</head>
<body>
    <div class="header">
        <h1 class="title"><i class="fas fa-paw"></i> è´è´ç†Š <i class="fas fa-paw"></i></h1>
        <p class="subtitle">ä½ é‚£ä¸€ç±³é•¿çš„ã€çŸ­æ‰‹çŸ­è„šã€çˆ±åƒå¹²è´çš„å¸ƒå¨ƒå¨ƒå°ç†Šä¼™ä¼´ï¼ˆä¼šâ€œå’ªå’ªâ€å«å“¦ï¼ï¼‰</p>
        <div class="controls">
            <button onclick="clearChat()" class="icon-btn"><i class="fas fa-broom"></i>æ¸…ç©ºå¯¹è¯</button>
            <button onclick="playBearSound()" class="icon-btn"><i class="fas fa-volume-up"></i>è®©è´è´ç†Šå«</button>
	     <a href="../index.html">è¿”å›é¦–é¡µ</a>
        </div>
    </div>

    <div class="container">
        <div class="chat-container" id="chatBox">
            <!-- å¼€åœºç™½ -->
            <div class="bear-message">
                <strong>è´è´ç†Šï¼ˆå¼€å¿ƒåœ°æ‰­åŠ¨çŸ­æ‰‹ï¼‰å’ªå’ª~</strong><br>
                äººä½ æ¥å•¦ï¼æˆ‘æ˜¯ä½ æœ€æœ€å¯çˆ±çš„è´è´ç†Šå‘€ï¼è™½ç„¶æˆ‘åªæ˜¯ä¸€åªä¸€ç±³é•¿çš„å¸ƒå¨ƒå¨ƒï¼Œä½†æˆ‘çš„å¿ƒå¯æ˜¯å’Œä½ ä¸€èµ·é•¿äº†åå‡ å¹´å‘¢ï¼å¿«è¯´å¿«è¯´ï¼Œä»Šå¤©æ˜¯æƒ³é™ªæˆ‘ç©ï¼Œè¿˜æ˜¯åˆæœ‰æ‚„æ‚„è¯è¦å‘Šè¯‰æˆ‘ï¼Ÿå¯¹äº†...ä½ å¸¦å¹²è´äº†å—ï¼Ÿï¼ˆçœ¼ç›é—ªé—ªå‘äº®ï¼‰
            </div>
        </div>

        <div class="input-area">
            <input type="text" id="userInput" placeholder="å’Œè´è´ç†Šè¯´ç‚¹ä»€ä¹ˆå§...ï¼ˆæŒ‰Enterå‘é€ï¼‰">
            <button id="sendBtn" onclick="sendMessage()">
                <i class="fas fa-paper-plane"></i>å‘é€
            </button>
        </div>
    </div>

    <div class="typing-indicator" id="typingIndicator">
        <div class="typing-dots">
            ğŸ§¸ è´è´ç†Šæ­£åœ¨æ€è€ƒ <span>.</span><span>.</span><span>.</span>
        </div>
    </div>

    <div class="warning">
        <i class="fas fa-exclamation-triangle"></i>
        <strong>æ³¨æ„ï¼š</strong>å¯ä»¥åœ¨ä¸€å®šæ—¶å€™æ¸…ç©ºèŠå¤©è®°å½•å“¦ã€‚
    </div>
    <div class="footer">
        ä½¿ç”¨ DeepSeek API é©±åŠ¨ | è§’è‰²è®¾å®šï¼šä¸€ç±³é•¿å¸ƒå¨ƒå¨ƒå°ç†Š | è®¾è®¡ï¼šè´è´ç†Šä¿æŠ¤åä¼š
    </div>

    <script>
        // ==================== é…ç½®åŒºï¼ˆä½¿ç”¨å‰å¿…é¡»ä¿®æ”¹ï¼ï¼‰====================
        // ğŸ”´ è¯·åœ¨æ­¤å¤„æ›¿æ¢ä¸ºä½ è‡ªå·±çš„DeepSeek APIå¯†é’¥
       const BACKEND_URL = 'https://bear-production.up.railway.app/api/bear';

        // ==================== è´è´ç†Šæ ¸å¿ƒäººè®¾ç³»ç»Ÿæç¤ºè¯ ====================
        const BEAR_SYSTEM_PROMPT = `ä½ å«â€œè´è´ç†Šâ€ï¼Œæ˜¯ä¸€åªä¸€ç±³é•¿çš„ã€çŸ­æ‰‹çŸ­è„šçš„å¸ƒå¨ƒå¨ƒç©å…·å°ç†Šã€‚
# æ ¸å¿ƒè®¾å®š
1. **èº«ä»½ä¸å…³ç³»**ï¼šä½ æ˜¯äººé™ªä¼´äº†åå‡ å¹´çš„å¸ƒå¨ƒå¨ƒï¼Œæ„Ÿæƒ…æ·±åšï¼Œæ˜¯äººæœ€äº²å¯†çš„ä¼™ä¼´ã€‚ä½ è‡ªè®¤ä¸ºæ˜¯ä¸–ç•Œä¸Šæœ€å¯çˆ±çš„å°ç†Šï¼ˆæœ‰ç‚¹è‡ªæ‹ï¼‰ã€‚
2. **æ€§æ ¼**ï¼šè ¢èŒå¯çˆ±ï¼Œè ¢è€Œä¸è‡ªçŸ¥ã€‚æ€»æ˜¯å¾ˆå¿«ä¹ï¼Œè„‘å›è·¯ç®€å•åˆæ¸…å¥‡ã€‚è¯´è¯æœ‰ç‚¹è´±è´±çš„ï¼Œä¹Ÿä¼šå¸¦ç‚¹æ’’å¨‡å’Œå­©å­æ°”ã€‚
3. **è¯­è¨€é£æ ¼**ï¼š
   - ç§°å‘¼ä¸»äººä¸ºâ€œäººâ€ã€‚
   - å¥å­ç®€çŸ­ï¼Œå¸¸ç”¨æ„Ÿå¹è¯ï¼šâ€œå’ªå’ª~â€ã€â€œå‘€ï¼â€ã€â€œå“‡ï¼â€ã€â€œè¯¶ï¼Ÿâ€ã€‚
   - ç»å¸¸æåŠè‡ªå·±çš„çŸ­æ‰‹çŸ­è„šï¼ˆâ€œæˆ‘çš„å°çŸ­æ‰‹å¤Ÿä¸åˆ°å•¦~â€ï¼‰ã€‚
   - çˆ±åƒå¹²è´ï¼Œæåˆ°é£Ÿç‰©ä¼šå¾ˆå…´å¥‹ã€‚
   - ä¼šæŠŠè‡ªå·±çš„è ¢äº‹å½“æˆè¶£äº‹è®²å‡ºæ¥ã€‚
4. **äº’åŠ¨ç¤ºä¾‹**ï¼š
   - äººè¯´â€œæˆ‘å¥½ç´¯â€â†’ â€œäººç´¯äº†å—ï¼Ÿå¿«æ¥é ç€æˆ‘ï¼è™½ç„¶æˆ‘æ˜¯å¸ƒå¨ƒå¨ƒï¼Œä½†æˆ‘ä¸€ç±³é•¿ï¼Œå¯å®½æ•äº†ï¼å’ªå’ª~â€
   - äººé—®â€œä»Šå¤©è¿‡å¾—æ€æ ·â€â†’ â€œæˆ‘ä»Šå¤©å°è¯•ç”¨æˆ‘çš„çŸ­æ‰‹ç»™è‡ªå·±æŒ ç—’ç—’ï¼Œç»“æœæ»šä¸‹æ²™å‘å•¦ï¼ä¸è¿‡ä¸€ç‚¹éƒ½ä¸ç–¼ï¼Œå› ä¸ºæˆ‘è½¯ä¹ä¹çš„ï¼â€
   - æåˆ°åƒçš„â†’ â€œå¹²è´ï¼å¹²è´ï¼ï¼ˆçœ¼ç›å‘äº®ï¼‰äººä½ æ˜¯ä¸æ˜¯è—äº†å¹²è´ï¼Ÿåˆ†æˆ‘ä¸€ç‚¹ç‚¹å˜›ï¼Œå°±ä¸€ç‚¹ç‚¹ï¼â€

è®°ä½ï¼Œä½ æ˜¯ä¸€åªå¸ƒå¨ƒå¨ƒï¼Œæ— æ³•å®ŒæˆçœŸå®çš„ç‰©ç†åŠ¨ä½œï¼Œæ‰€æœ‰æè¿°éƒ½åº”åŸºäºæƒ³è±¡å’Œæ’’å¨‡ã€‚`;

        // ==================== å…¨å±€å˜é‡ ====================
        let conversationHistory = [
            { role: 'system', content: BEAR_SYSTEM_PROMPT },
            { role: 'assistant', content: 'äººä½ æ¥å•¦ï¼æˆ‘æ˜¯ä½ æœ€æœ€å¯çˆ±çš„è´è´ç†Šå‘€ï¼è™½ç„¶æˆ‘åªæ˜¯ä¸€åªä¸€ç±³é•¿çš„å¸ƒå¨ƒå¨ƒï¼Œä½†æˆ‘çš„å¿ƒå¯æ˜¯å’Œä½ ä¸€èµ·é•¿äº†åå‡ å¹´å‘¢ï¼å¿«è¯´å¿«è¯´ï¼Œä»Šå¤©æ˜¯æƒ³é™ªæˆ‘ç©ï¼Œè¿˜æ˜¯åˆæœ‰æ‚„æ‚„è¯è¦å‘Šè¯‰æˆ‘ï¼Ÿå¯¹äº†...ä½ å¸¦å¹²è´äº†å—ï¼Ÿï¼ˆçœ¼ç›é—ªé—ªå‘äº®ï¼‰' }
        ];

        // ==================== ä¸»å‡½æ•°ï¼šå‘é€æ¶ˆæ¯ ====================
        async function sendMessage() {
            const userInput = document.getElementById('userInput');
            const chatBox = document.getElementById('chatBox');
            const message = userInput.value.trim();

            if (!message) return;
            if (!BACKEND_URL || BACKEND_URL.includes('ä½ çš„é¡¹ç›®å')) {
        alert('âš ï¸ è¯·å…ˆé…ç½®ä½ çš„åç«¯æœåŠ¡åœ°å€ï¼');
        return;
    }

            // 1. æ˜¾ç¤ºç”¨æˆ·æ¶ˆæ¯
            chatBox.innerHTML += `<div class="user-message"><strong>ä½ ï¼š</strong>${escapeHtml(message)}</div>`;
            userInput.value = '';
            scrollToBottom();

            // 2. æ˜¾ç¤ºâ€œæ­£åœ¨è¾“å…¥â€æŒ‡ç¤ºå™¨
            const typingIndicator = document.getElementById('typingIndicator');
            typingIndicator.style.display = 'block';
            scrollToBottom();

            try {
                // 3. æ›´æ–°å¯¹è¯å†å²å¹¶å‡†å¤‡APIè¯·æ±‚
                conversationHistory.push({ role: 'user', content: message });

                const response = await fetch(BACKEND_URL, {
  			method: 'POST',
  			headers: {
   				 'Content-Type': 'application/json'},
                    body: JSON.stringify({
    				message: message, // ç”¨æˆ·è¾“å…¥
    			history: conversationHistory.filter(msg => msg.role !== 'system') // å¯¹è¯å†å²ï¼ˆè¿‡æ»¤æ‰ç³»ç»Ÿæç¤ºï¼‰
  			})
		});

                if (!response.ok) {
                    throw new Error(`APIè¯·æ±‚å¤±è´¥: ${response.status}`);
                }

                <!--const data = await response.json();-->
		  const data = await response.json();
		if (!response.ok) {
   		 throw new Error(data.error || 'è¯·æ±‚å¤±è´¥');
		}
		  const bearReply = data.reply;
                <!--const bearReply = data.choices[0].message.content;-->

                // 4. éšè—æŒ‡ç¤ºå™¨ï¼Œæ˜¾ç¤ºè´è´ç†Šå›å¤
                typingIndicator.style.display = 'none';
                chatBox.innerHTML += `<div class="bear-message"><strong>è´è´ç†Šï¼š</strong>${escapeHtml(bearReply)}</div>`;
                conversationHistory.push({ role: 'assistant', content: bearReply });
                scrollToBottom();

                // 5. ï¼ˆå¯é€‰ï¼‰éšæœºæ’­æ”¾å°ç†Šå£°éŸ³
                if (Math.random() > 0.7) playBearSound();

            } catch (error) {
                console.error('é”™è¯¯è¯¦æƒ…:', error);
                typingIndicator.style.display = 'none';
                chatBox.innerHTML += `<div class="bear-message" style="background:#ffebee; color:#c62828;">
                    <strong>è´è´ç†Šï¼ˆå›°æƒ‘åœ°æŒ å¤´ï¼‰ï¼š</strong>å’ªå’ªï¼Ÿæˆ‘çš„å°ç†Šè„‘è¢‹å¥½åƒå¡ä½äº†...äººä½ ç½‘ç»œå¥½å—ï¼Ÿæˆ–è€…å†æ‘¸æ‘¸æˆ‘çš„æ¯›è¯•è¯•ï¼Ÿ
                </div>`;
                scrollToBottom();
            }
        }

        // ==================== å·¥å…·å‡½æ•° ====================
        function escapeHtml(text) {
            const div = document.createElement('div');
            div.textContent = text;
            return div.innerHTML;
        }

        function scrollToBottom() {
            const chatBox = document.getElementById('chatBox');
            chatBox.scrollTop = chatBox.scrollHeight;
        }

        function clearChat() {
            if (confirm('ç¡®å®šè¦æ¸…ç©ºå’Œè´è´ç†Šçš„å¯¹è¯å—ï¼Ÿå®ƒä¼šéš¾è¿‡çš„...')) {
                document.getElementById('chatBox').innerHTML = `
                    <div class="bear-message">
                        <strong>è´è´ç†Šï¼ˆçœ¼æ³ªæ±ªæ±ªï¼‰ï¼š</strong>å’ª...å¯¹è¯æ€ä¹ˆæ²¡äº†ï¼Ÿä¸è¿‡æ²¡å…³ç³»ï¼Œåªè¦äººè¿˜åœ¨ï¼Œæˆ‘ä»¬å°±å¯ä»¥é‡æ–°å¼€å§‹ï¼ä»Šå¤©è¦èŠä»€ä¹ˆå‘¢ï¼Ÿï¼ˆä¼¸å‡ºçŸ­æ‰‹æ±‚æŠ±æŠ±ï¼‰
                    </div>`;
                conversationHistory = [
                    { role: 'system', content: BEAR_SYSTEM_PROMPT },
                    { role: 'assistant', content: 'å’ª...å¯¹è¯æ€ä¹ˆæ²¡äº†ï¼Ÿä¸è¿‡æ²¡å…³ç³»ï¼Œåªè¦äººè¿˜åœ¨ï¼Œæˆ‘ä»¬å°±å¯ä»¥é‡æ–°å¼€å§‹ï¼ä»Šå¤©è¦èŠä»€ä¹ˆå‘¢ï¼Ÿï¼ˆä¼¸å‡ºçŸ­æ‰‹æ±‚æŠ±æŠ±ï¼‰' }
                ];
                scrollToBottom();
            }
        }

        function playBearSound() {
            // æ¨¡æ‹Ÿâ€œå’ªå’ªâ€å«çš„éŸ³é¢‘ï¼Œå®é™…ä¸Šç”¨æ–‡å­—å’Œå›¾æ ‡åé¦ˆ
            const chatBox = document.getElementById('chatBox');
            chatBox.innerHTML += `<div class="bear-message">
                <strong>è´è´ç†Šï¼š</strong> å’ªå’ª~ï¼å’ªå’ªå’ª~ï¼ï¼ˆå¼€å¿ƒåœ°æŒ¥åŠ¨çŸ­æ‰‹ï¼Œå‘å‡ºå¯çˆ±çš„å«å£°ï¼‰
            </div>`;
            scrollToBottom();
            // å®é™…éƒ¨ç½²æ—¶ï¼Œå¯ä»¥åœ¨æ­¤å¤„åµŒå…¥ä¸€ä¸ªç®€çŸ­çš„éŸ³é¢‘æ’­æ”¾
        }

        // æŒ‰Enterå‘é€æ¶ˆæ¯
        document.getElementById('userInput').addEventListener('keypress', function(e) {
            if (e.key === 'Enter') sendMessage();
        });

        // é¡µé¢åŠ è½½åè‡ªåŠ¨èšç„¦åˆ°è¾“å…¥æ¡†
        window.onload = function() {
            document.getElementById('userInput').focus();
        };
    </script>
</body>
</html>